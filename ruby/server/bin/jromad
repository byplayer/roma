#!/usr/bin/env jruby

path =  File.dirname(File.expand_path($PROGRAM_NAME))
$LOAD_PATH << path + "/../lib"
$LOAD_PATH << path  + "/../../commons/lib"

require 'roma/romad'

def daemonize
  Signal.trap(:INT){
    exit! 0
  }
  Signal.trap(:TERM){
    exit! 0
  }
  Signal.trap(:HUP){
    exit! 0
  }
  File.open("/dev/null","r+"){|f|
    STDIN.reopen f
    STDOUT.reopen f
    STDERR.reopen f
  }
end

Roma::Romad.class_eval {
}

$roma = Roma::Romad.new(ARGV)
if $roma.daemon?
  STDERR.puts $$
  daemonize
  $roma.start
else
  $roma.start
end
